<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>半目テスト</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: black;
    overflow: hidden;
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="eyeCanvas" width="1920" height="1080"></canvas>
<script>
const canvas = document.getElementById("eyeCanvas");
const ctx = canvas.getContext("2d");
canvas.width = 1920;
canvas.height = 1080;

let eye = {
  x: 960,
  y: 540,
  baseY: 540,
  radius: 80,
  blink: 0,
  mode: "idle"
};

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  
  // 白目（灰色の円）
  ctx.fillStyle = "#ddd";
  ctx.beginPath();
  ctx.arc(960, 540, 250, 0, Math.PI * 2);
  ctx.fill();

  // 半目マスク
  const maskHeight = 500 * (0.5 + 0.5 * (1 - eye.blink));
  ctx.save();
  ctx.beginPath();
  ctx.rect(960 - 250, 540 - maskHeight / 2, 500, maskHeight);
  ctx.clip();

  // 黒目
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.arc(eye.x, eye.y, eye.radius, 0, Math.PI * 2);
  ctx.fill();

  ctx.restore();
}

// --- Aセット ---
function animateSetA() {
  const start = performance.now();
  const duration = 3000;
  const moveRange = 150;
  function frame(now) {
    const t = (now - start) / duration;
    if (t > 1) { eye.x = 960; eye.mode = "idle"; return; }
    const angle = Math.sin(t * Math.PI * 4);
    eye.x = 960 + angle * moveRange;
    draw();
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

// --- 瞬き ---
function animateSetC() {
  const start = performance.now();
  const duration = 400;
  function frame(now) {
    const t = (now - start) / duration;
    if (t > 1) { eye.blink = 0; eye.mode = "idle"; return; }
    eye.blink = Math.sin(t * Math.PI);
    draw();
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

// --- ループ ---
function loop() {
  if (eye.mode === "idle") {
    const r = Math.random();
    if (r < 0.6) { eye.mode = "A"; animateSetA(); }
    else { eye.mode = "C"; animateSetC(); }
  }
  draw();
  requestAnimationFrame(loop);
}

draw();
loop();
</script>
</body>
</html>